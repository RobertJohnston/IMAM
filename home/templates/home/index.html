{% extends "home/header.html" %}
{% load staticfiles %}

{% block content %}

    <div>

        <script type="text/javascript">
        // wait until page is loaded

        $(document).ready(function() {
            $(".js-example-basic-single").select2();
            $("#filter-by-site").val("").trigger("change");
            // must trigger event for select2 to update display

        });
        </script>
    </div>

    <select class="js-example-basic-single" id="filter-by-site">
        <option value="" selected="selected">National</option>
        {% for site in state_list %}
        <option value="state-{{ site.state_num }}">{{ site.state }}</option>
        {% endfor %}
        {% for site in lga_list %}
        <option value="lga-{{ site.lga_num }}">{{ site.lga }}</option>
        {% endfor %}
        {% for site in site_list %}
        <option value="site-{{ site.siteid }}">{{ site.sitename }}</option>
        {% endfor %}
    </select>


        <!--{% for siteid in lga_list %}-->
        <!--<option value="lga-{{ siteid.lga_num }}">{{ siteid.lga }}</option>-->
        <!--{% endfor %}-->


    <div id="admissions-chart">
        <p>Chart</p>
        <!--style="width:100%;height:314px"-->

    </div>

    <script>
        format_data = function(data) {
            return {
                title: {text: data.title},

                // subtitle not working
                subtitle: {
                    text: "Admissions and Performance Indicators by Week",
                    floating: true,
                },

                subtitle: {
                    text: 'IMAM Nigeria  {{ data.date }}',
                    align: 'right',
                    verticalAlign: 'bottom',
                    x: -50,
                    y: 10
                },
                xAxis: [{

                    // categories: data.adm_by_week,
                    // highcharts automatically knows the first of 2 # in series is x axis.

                    crosshair: true,
                    title: {
                        text: 'Week Number'
                    },
                }],
                 credits: {
                    enabled: false
                },

                yAxis: [{ // Primary yAxis
                    labels: {
                        format: '{value}',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    },
                    title: {
                        text: 'Admissions',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    }

                }, { // Secondary yAxis
                    min: 0,
                    max: 100,
                    title: {
                        text: 'Percentage',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    },
                    labels: {
                        format: '{value}',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        },
                    },
                    opposite: true
                }],
                tooltip: {
                    shared: true
                },

                legend: {
                    layout: 'vertical',
                    align: 'left',
                    x: 80,
                    verticalAlign: 'top',
                    y: 20,
                    floating: true,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
                },

                "series":[{
                    "name":"Admissions",
                    type: 'column',
                    "data": data.adm_by_week,
                    "yAxis":0,
                    color: '#ffcccc',
                    tooltip: {
                        valueSuffix: ' cases'
                    }
                },
                    {
                    name: 'Default Rate',
                    type: 'line',
                    yAxis: 1,
                    data: data.defu_rate_by_week,
                    color: '#000000',
                    marker: { enabled: false},
                    tooltip: {
                        yDecimals: 1
                    }
                                }, {
                    name: 'Transfer Rate',
                    type: 'line',
                    yAxis: 1,
                    data: data.tout_rate_by_week,
                    dashStyle: 'shortdot',
                    color: '#FFA500',
                    marker: { enabled: false},
                    tooltip: {
                        pointFormat: "Transfer Rate: {point.y:,.1f} %"
                        <!--valueSuffix: '%'-->
                    }

                }, {
                    name: 'Non-recovered Rate',
                    type: 'line',
                    yAxis: 1,
                    data: data.dmed_rate_by_week,
                    dashStyle: 'dash',
                    color: '#9370DB',
                    marker: { enabled: false},
                    tooltip: {
                        pointFormat: "Non-recovered Rate: {point.y:,.1f} %"
                        <!--valueSuffix: '%'-->
                    }

                }, {
                    name: 'Death Rate',
                    type: 'line',
                    yAxis: 1,
                    data: data.dead_rate_by_week,
                    color: '#FF0000',
                    tooltip: {
                        pointFormat: "Death Rate: {point.y:,.1f} %"
                        <!--valueSuffix: '%'-->
                    }
                }],

                "chart":{"renderTo":"admissions-chart"},
            }
        }
        $.getJSON("/adm/").success(function(data) {
            amarChart = new Highcharts.Chart(format_data(data));
        });

        // on select event - run code in {} below

        $("#filter-by-site").on("select2:select", function (e) {
            var siteFilter = $("#filter-by-site").val();

            $.getJSON("/adm/?site_filter=" + siteFilter).success(function(data) {
                amarChart.update(format_data(data));
            });
        });
    </script>


{% include "home/includes/htmlsnippet.html" %}

<!--htmlsnippet could include an error message that is repeated on many different pages. -->

{% endblock %}

<!--see calazan.com - using highcharts with django 1.6 and bootstrap-->


